<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GPA | Student Companion</title>
  <style>
    /* ===== DARK BLUE COLOR SCHEME ===== */
    :root {
      --bg-primary: #0a0f2b;
      --bg-secondary: #131b3d;
      --bg-card: #1a2452;
      --bg-hover: #242f6b;
      --accent-primary: #3a7bd5;
      --accent-secondary: #00d2ff;
      --accent-danger: #ff4757;
      --text-primary: #ffffff;
      --text-secondary: #a0a8d6;
      --text-muted: #6b7299;
      --border-color: #2a3566;
      --shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
      --shadow-light: 0 4px 15px rgba(58, 123, 213, 0.3);
      --radius: 12px;
      --radius-sm: 8px;
    }

    /* ===== GLOBAL STYLES ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      font-family: 'Poppins', sans-serif;
    }

    body {
      background: linear-gradient(135deg, var(--bg-primary), var(--bg-secondary));
      color: var(--text-primary);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      line-height: 1.6;
    }

    /* ===== NAVBAR ===== */
    .navbar {
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 5%;
      background: var(--bg-secondary);
      border-bottom: 2px solid var(--accent-primary);
      position: fixed;
      top: 0;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .brand {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--accent-secondary);
    }

    .nav-right a {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background: var(--bg-card);
      border-radius: 50%;
      transition: all 0.3s ease;
    }

    .nav-right a:hover {
      background: var(--accent-primary);
      transform: scale(1.1);
    }

    .nav-right img {
      width: 24px;
      height: 24px;
      filter: invert(1);
    }

    /* ===== USER GREETING ===== */
    .user-greet {
      position: fixed;
      left: 16px;
      bottom: 20px;
      z-index: 9998;
      padding: 8px 12px;
      border-radius: 8px;
      background: rgba(0, 0, 0, 0.35);
      backdrop-filter: blur(4px);
      font-size: 0.9rem;
    }

    /* ===== MAIN CONTENT ===== */
    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      margin-top: 80px;
      margin-bottom: 60px;
      width: 100%;
      padding: 20px;
    }

    .container {
      width: 100%;
      max-width: 800px;
      background: var(--bg-card);
      border-radius: var(--radius);
      padding: 30px;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      gap: 25px;
    }

    h1 {
      color: var(--accent-secondary);
      text-align: center;
      font-size: 2rem;
      margin-bottom: 10px;
    }

    /* ===== GPA FORM ===== */
    #gpaForm {
      display: flex;
      flex-direction: column;
      gap: 15px;
      width: 100%;
    }

    #gpaForm input, #gpaForm select {
      width: 100%;
      padding: 15px;
      border-radius: var(--radius-sm);
      border: 1px solid var(--border-color);
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-size: 1rem;
      outline: none;
      transition: all 0.3s ease;
    }

    #gpaForm input:focus, #gpaForm select:focus {
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 2px rgba(58, 123, 213, 0.3);
    }

    .form-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 10px;
    }

    .btn {
      padding: 15px 25px;
      border: none;
      border-radius: var(--radius-sm);
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 1rem;
      flex: 1;
    }

    .btn-primary {
      background: var(--accent-primary);
      color: white;
      box-shadow: var(--shadow-light);
    }

    .btn-primary:hover {
      background: #2d68c4;
      transform: scale(1.05);
    }

    .btn-secondary {
      background: var(--text-muted);
      color: white;
    }

    .btn-secondary:hover {
      background: #5a6280;
      transform: scale(1.05);
    }

    /* ===== GPA LIST ===== */
    #gpaList {
      list-style: none;
      padding: 0;
      width: 100%;
      margin-top: 20px;
    }

    #gpaList li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      margin-bottom: 12px;
      border-radius: var(--radius-sm);
      background: var(--bg-secondary);
      transition: all 0.3s ease;
      border-left: 4px solid transparent;
    }

    #gpaList li:hover {
      background: var(--bg-hover);
      transform: translateX(5px);
    }

    .course-info {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .course-name {
      font-weight: bold;
      color: var(--text-primary);
    }

    .course-details {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .actions {
      display: flex;
      gap: 8px;
    }

    .actions button {
      border: none;
      border-radius: 6px;
      padding: 8px 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .edit-btn {
      background: var(--accent-primary);
      color: white;
    }

    .edit-btn:hover {
      background: #2d68c4;
      transform: scale(1.1);
    }

    .delete-btn {
      background: var(--accent-danger);
      color: white;
    }

    .delete-btn:hover {
      background: #ff3742;
      transform: scale(1.1);
    }

    /* ===== GPA RESULT ===== */
    #gpaResult {
      margin-top: 25px;
      font-size: 2.2rem;
      color: var(--accent-secondary);
      font-weight: bold;
      text-align: center;
      text-shadow: 0 0 10px rgba(0, 210, 255, 0.3);
    }

    .gpa-label {
      font-size: 1.5rem;
      color: var(--text-secondary);
      margin-right: 10px;
    }

    /* ===== FLOATING AI ===== */
    .floating-ai {
      position: fixed;
      bottom: 18px;
      right: 22px;
      background:#0a0f2b;
      padding: 12px 18px;
      border-radius: 30px;
      color: white;
      font-weight: 600;
      font-size: medium;
      text-decoration: none;
      box-shadow: var(--shadow-light);
      transition: 0.3s ease;
      z-index: 999;
    }

    .floating-ai:hover {
      transform: scale(1.07);
      box-shadow: 0 0 20px rgba(0, 210, 255, 0.7);
    }

    /* ===== RESPONSIVE DESIGN ===== */
    @media (max-width: 768px) {
      .navbar {
        padding: 12px 5%;
      }
      
      .brand {
        font-size: 1.3rem;
      }
      
      main {
        margin-top: 70px;
        padding: 15px;
      }
      
      .container {
        padding: 25px;
      }
      
      h1 {
        font-size: 1.8rem;
      }
      
      .form-buttons {
        flex-direction: column;
      }
      
      #gpaList li {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
      
      .actions {
        align-self: flex-end;
      }
      
      #gpaResult {
        font-size: 1.8rem;
      }
    }

    @media (max-width: 480px) {
      .navbar {
        padding: 10px 5%;
      }
      
      .brand {
        font-size: 1.2rem;
      }
      
      main {
        margin-top: 65px;
        padding: 10px;
      }
      
      .container {
        padding: 20px;
      }
      
      h1 {
        font-size: 1.6rem;
      }
      
      #gpaForm input, #gpaForm select {
        padding: 12px;
      }
      
      .btn {
        padding: 12px 20px;
        font-size: 0.9rem;
      }
      
      #gpaList li {
        padding: 12px;
      }
      
      #gpaResult {
        font-size: 1.6rem;
      }
      
      .user-greet {
        font-size: 0.8rem;
        left: 12px;
        bottom: 15px;
      }
      
      .floating-ai {
        padding: 10px 15px;
        font-size: 14px;
        bottom: 15px;
        right: 15px;
      }
    }

    @media (max-width: 360px) {
      .container {
        padding: 15px;
      }
      
      h1 {
        font-size: 1.4rem;
      }
      
      #gpaResult {
        font-size: 1.4rem;
      }
    }

    /* ===== CUSTOM SCROLLBAR ===== */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-secondary);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--accent-primary);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #2d68c4;
    }
  </style>
</head>
<body>
  <!-- User Greeting -->
  <div class="user-greet" id="userGreet"></div>

  <!-- Navbar -->
  <nav class="navbar">
    <div class="brand">Student Companion</div>
    <div class="nav-right">
      <a href="homepage.html">
        <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZmZmZmZmIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PHBhdGggZD0ibTE1IDE4LTYtNiA2LTYiLz48L3N2Zz4=" alt="Back">
      </a>
    </div>
  </nav>

  <!-- Main Content -->
  <main>
    <div class="container">
      <h1>üìä GPA Calculator</h1>
      
      <form id="gpaForm">
        <input id="courseName" type="text" placeholder="Course name" required>
        <select id="courseGrade" required>
          <option value="">Select Grade</option>
          <option value="A">A (5 points)</option>
          <option value="B">B (4 points)</option>
          <option value="C">C (3 points)</option>
          <option value="D">D (2 points)</option>
          <option value="E">E (1 point)</option>
          <option value="F">F (0 points)</option>
        </select>
        <input id="courseUnits" type="number" placeholder="Credit Units" min="1" max="10" required>
        
        <div class="form-buttons">
          <button type="submit" class="btn btn-primary">
            <span>‚ûï</span> Add Course
          </button>
          <button type="button" class="btn btn-secondary" id="cancelCourseEditBtn" style="display:none;">
            Cancel Edit
          </button>
        </div>
      </form>

      <ul id="gpaList"></ul>
      
      <div id="gpaResult">
        <span class="gpa-label">üéØ GPA:</span> <span id="gpaValue">0.00</span>
      </div>
    </div>
  </main>

  <!-- Floating AI Button -->
  <a href="ai.html" class="floating-ai">ü§ñ AI Assistant</a>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // ====== USER & LOGOUT ======
      function getCurrentUser() { 
        return localStorage.getItem("currentUser"); 
      }
      
      const user = getCurrentUser();
      if(!user) { 
        alert("Please log in!"); 
        window.location.href = "index.html"; 
      }
      
      // Set user greeting
      if (user) {
        const userGreetEl = document.getElementById("userGreet");
        if (userGreetEl) {
          userGreetEl.textContent = `Hi, ${user}`;
        }
      }

      // Initialize user data
      let users = JSON.parse(localStorage.getItem("users")) || {};
      if(!users[user]) {
        users[user] = { 
          password: "", 
          notes: [], 
          timetable: [], 
          gpa: [], 
          profile: {}, 
          notifications: [] 
        };
        localStorage.setItem("users", JSON.stringify(users));
      }
      
      // Reload users data
      users = JSON.parse(localStorage.getItem("users"));

      // ====== GPA CALCULATOR ======
      const gpaForm = document.getElementById("gpaForm");
      const courseName = document.getElementById("courseName");
      const courseGrade = document.getElementById("courseGrade");
      const courseUnits = document.getElementById("courseUnits");
      const gpaList = document.getElementById("gpaList");
      const gpaValue = document.getElementById("gpaValue");
      const cancelBtn = document.getElementById("cancelCourseEditBtn");

      const gradePoints = {A:5, B:4, C:3, D:2, E:1, F:0};
      let courses = users[user].gpa || [];
      let editIndex = null;

      // Save courses to localStorage
      function saveCourses() { 
        users[user].gpa = courses; 
        localStorage.setItem("users", JSON.stringify(users)); 
      }

      // Calculate GPA
      function calculateGPA() {
        let totalUnits = 0, totalPoints = 0;
        courses.forEach(c => { 
          totalUnits += c.units; 
          totalPoints += gradePoints[c.grade] * c.units; 
        });
        gpaValue.textContent = totalUnits > 0 ? (totalPoints / totalUnits).toFixed(2) : "0.00";
      }

      // Display courses in the list
      function displayCourses() {
        gpaList.innerHTML = "";
        
        if (courses.length === 0) { 
          gpaList.innerHTML = '<li style="color: var(--text-muted); text-align: center; padding: 20px;">No courses added yet. Start by adding your first course above.</li>'; 
          gpaValue.textContent = "0.00";
          return; 
        }
        
        courses.forEach((c, i) => {
          const li = document.createElement("li");
          li.innerHTML = `
            <div class="course-info">
              <div class="course-name">${c.name}</div>
              <div class="course-details">Grade: ${c.grade} | Units: ${c.units}</div>
            </div>
            <div class="actions">
              <button class="edit-btn" onclick="editCourse(${i})">‚úèÔ∏è</button>
              <button class="delete-btn" onclick="deleteCourse(${i})">üóëÔ∏è</button>
            </div>
          `;
          gpaList.appendChild(li);
        });
        
        calculateGPA();
      }

      // Handle form submission
      gpaForm.addEventListener("submit", e => {
        e.preventDefault();
        const name = courseName.value.trim();
        const grade = courseGrade.value;
        const units = parseInt(courseUnits.value);
        
        if (!name || !grade || isNaN(units) || units < 1) { 
          alert("Please fill all fields correctly!"); 
          return; 
        }
        
        const newCourse = { name, grade, units };
        
        if (editIndex !== null) { 
          courses[editIndex] = newCourse; 
          editIndex = null; 
          cancelBtn.style.display = "none"; 
        } else { 
          courses.push(newCourse); 
        }
        
        saveCourses(); 
        displayCourses(); 
        gpaForm.reset();
      });

      // Edit course function
      window.editCourse = function(i) { 
        const c = courses[i]; 
        courseName.value = c.name; 
        courseGrade.value = c.grade; 
        courseUnits.value = c.units; 
        editIndex = i; 
        cancelBtn.style.display = "flex"; 
        
        // Scroll to form
        gpaForm.scrollIntoView({ behavior: 'smooth' });
      };

      // Cancel edit
      cancelBtn.addEventListener("click", () => { 
        editIndex = null; 
        cancelBtn.style.display = "none"; 
        gpaForm.reset(); 
      });

      // Delete course function
      window.deleteCourse = function(i) { 
        if (confirm("Are you sure you want to delete this course?")) { 
          courses.splice(i, 1); 
          saveCourses(); 
          displayCourses(); 
        } 
      };

      // Initialize the display
      displayCourses();
    });
  </script>
</body>
</html>