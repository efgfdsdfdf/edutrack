<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat Assistant</title>
    <style>
        
    /* ===== DARK BLUE COLOR SCHEME ===== */
    :root {
      --bg-primary: #0a0f2b;
      --bg-secondary: #131b3d;
      --bg-card: #1a2452;
      --bg-hover: #242f6b;
      --accent-primary: #3a7bd5;
      --accent-secondary: #00d2ff;
      --accent-danger: #ff4757;
      --text-primary: #ffffff;
      --text-secondary: #a0a8d6;
      --text-muted: #6b7299;
      --border-color: #2a3566;
      --shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
      --shadow-light: 0 4px 15px rgba(58, 123, 213, 0.3);
      --radius: 12px;
      --radius-sm: 8px;
    }

    /* ===== GLOBAL STYLES ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

.message.user {
  align-self: flex-end;
  background: #242424;
  color: #fdfbfb;
}

.upload-menu button {
  background: transparent;
  border: none;
  color: #00ffcc;
  cursor: pointer;
  padding: 5px 10px;
}

.message.ai {
  align-self: flex-start;
  background: #171717;
  border: 1px solid #292a2a55;
}

form {
  display: flex;
  align-items: center;
  padding: 10px 15px;
  background: #0f0f0f;
  border-top: 1px solid #00ffcc33;
}

#user-input {
  flex: 1;
  padding: 12px;
  background: #1a1a1a;
  border: 1px solid #00ffcc33;
  color: #fff;
  border-radius: 10px;
  outline: none;
}

    html, body {
      height: 100%;
      font-family: 'Poppins', sans-serif;
    }

    body {
      background: linear-gradient(135deg, var(--bg-primary), var(--bg-secondary));
      color: var(--text-primary);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      line-height: 1.6;
      
    }

    /* ===== AI LAYOUT ===== */
    .ai-layout {
      display: flex;
      height: 100vh;
      width: 100%;
    }

    /* ===== SIDEBAR ===== */
    .sidebar {
      width: 280px;
      background: var(--bg-card);
      border-right: 1px solid var(--border-color);
      display: flex;
      flex-direction: column;
      transition: all 0.3s ease;
      box-shadow: var(--shadow);
      z-index: 1000;
    }

    .sidebar-header {
      padding: 20px;
      border-bottom: 1px solid var(--border-color);
    }

    .sidebar-nav {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .sidebar-nav a {
      color: var(--text-secondary);
      text-decoration: none;
      padding: 12px 15px;
      border-radius: var(--radius-sm);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .sidebar-nav a:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    #new-chat-btn {
      width: 100%;
      padding: 12px;
      background: var(--accent-primary);
      color: white;
      border: none;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
    }

    #new-chat-btn:hover {
      background: #2d68c4;
      transform: scale(1.02);
    }

    .saved-chats {
      flex: 1;
      padding: 15px;
      overflow-y: auto;
    }

    .sidebar h3 {
      color: var(--accent-secondary);
      margin: 15px 0 10px 0;
      padding: 0 15px;
      font-size: 1.1rem;
    }

    .chat-list {
      list-style: none;
      padding: 0 15px;
    }

    .chat-list li {
      padding: 12px;
      margin-bottom: 8px;
      background: var(--bg-secondary);
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .chat-list li:hover {
      background: var(--bg-hover);
    }

    /* ===== MAIN CONTAINER ===== */
    .ai-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    /* ===== HEADER ===== */
    .ai-container header {
      display: flex;
      align-items: center;
      padding: 15px 20px;
      background: var(--bg-card);
      border-bottom: 1px solid var(--border-color);
    }

   

    .ai-container h1 {
      color: var(--accent-secondary);
      font-size: 1.5rem;
    
    }

    .ai-container h1 span {
      color: var(--text-primary);
    }

    /* ===== CHAT WINDOW ===== */
    .chat-window {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .message {
      max-width: 80%;
      padding: 15px;
      border-radius: var(--radius);
      line-height: 1.5;
      word-wrap: break-word;
    }

    .user-message {
      background: var(--accent-primary);
      color: white;
      align-self: flex-end;
      border-bottom-right-radius: 5px;
    }

    .ai-message {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
      align-self: flex-start;
      border-bottom-left-radius: 5px;
    }

    /* ===== LOADING INDICATOR ===== */
    .loading-indicator {
      text-align: center;
      padding: 10px;
      font-size: 1.5rem;
      display: none;
    }

    .loading-indicator.show {
      display: block;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% { opacity: 0.6; }
      50% { opacity: 1; }
      100% { opacity: 0.6; }
    }

    /* ===== CHAT FORM ===== */
    .chat-form {
      display: flex;
      padding: 15px;
      background: var(--bg-card);
      border-top: 1px solid var(--border-color);
      gap: 10px;
      align-items: flex-end;
    }

    .chat-form textarea {
      flex: 1;
      padding: 12px 15px;
      border-radius: var(--radius-sm);
      border: 1px solid var(--border-color);
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-size: 1rem;
      resize: none;
      outline: none;
      font-family: 'Poppins', sans-serif;
      max-height: 120px;
      min-height: 50px;
    }

    .chat-form textarea:focus {
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 2px rgba(58, 123, 213, 0.3);
    }

        

    .mic-btn {
      background:#000;
      color:#000;
      border: 1px solid var(--border-color);
      border-radius: var(--radius-sm);
      padding: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .mic-btn:hover {
      background: var(--bg-hover);
    }

    .chat-form button[type="submit"] {
      background: var(--accent-primary);
      color: white;
      border: none;
      border-radius: var(--radius-sm);
      padding: 12px 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
    }

    .chat-form button[type="submit"]:hover {
      background: #2d68c4;
      transform: scale(1.05);
    }
/* ===== UPLOAD CONTAINER ===== */
.upload-container {
  position: fixed;
  bottom: 90px;
  right: 20px;
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 10px;
  z-index: 100;
}

#uploadToggle {
  background: #000;
  color: white;
  border: none;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  font-size: 1.2rem;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: var(--shadow-light);
  z-index: 102;
}

#uploadToggle:hover {
  background: #0b0b0b;
  transform: scale(1.1);
}

.upload-menu {
  display: none; /* Hidden by default */
  flex-direction: column;
  gap: 10px;
  background: var(--bg-card);
  border-radius: var(--radius);
  padding: 10px;
  box-shadow: var(--shadow);
  border: 1px solid var(--border-color);
  z-index: 101;
  /* Menu opens downward */
  position: absolute;
  bottom: 60px; /* Position above the toggle button */
  right: 0;
  min-width: 150px;
}

/* Show menu when active - opens downward */
.upload-container.active .upload-menu {
  display: flex;
  animation: slideDown 0.2s ease-out;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.upload-menu button {
  background: var(--bg-secondary);
  color: var(--text-primary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  padding: 10px 15px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 8px;
  white-space: nowrap;
  width: 100%;
}

.upload-menu button:hover {
  background: var(--bg-hover);
}

/* ðŸ“· Compact camera preview */
#cameraStream {
  width: 200px;
  height: 140px;
  border-radius: 10px;
  border: 2px solid #00ffcc;
  object-fit: cover;
  display: none;
  position: fixed;
  top: 80px;
  right: 20px;
  z-index: 200;
  background: #000;
  box-shadow: 0 0 15px #00ffcc55;
}

/* Camera control buttons */
.camera-controls {
  position: fixed;
  bottom: 230px;
  right: 20px;
  display: none;
  gap: 10px;
  z-index: 201;
  flex-direction: column;
  align-items: center;
}

#captureBtn {
  background: #00ffcc;
  color: #000;
  border: none;
  padding: 10px 15px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
}

.send-btn {
  background: #00ffff;
  color: #000;
  border: none;
  padding: 8px 12px;
  border-radius: 8px;
  cursor: pointer;
}

.retake-btn {
  background: #ff0077;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 8px;
  cursor: pointer;
}

.send-btn:hover, .retake-btn:hover, #captureBtn:hover {
  transform: scale(1.05);
  opacity: 0.9;
}

/* Overlay to capture outside clicks */
.overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: transparent;
  z-index: 99;
  display: none;
}

.upload-container.active ~ .overlay {
  display: block;
}
   /* Sidebar Styles */

  /* Sidebar Styles */
.sidebar {
  position: fixed;
  top: 0;
  left: -280px; /* Hidden by default */
  width: 260px;
  height: 100%;
  background: #101018;
  color: #fff;
  box-shadow: 2px 0 10px rgba(0, 0, 0, 0.6);
  padding: 20px;
  transition: left 0.3s ease;
  z-index: 999;
  overflow-y: auto;
  border-right: 2px solid #00ffcc25;
  display: flex;
  flex-direction: column;
}

.sidebar.show {
  left: 0; /* Slides in */
}

/* Sidebar header - moved to top */
.sidebar-header {
  margin-bottom: 20px;
}

.sidebar h2 {
  color: #00ffcc;
  font-size: 18px;
  border-bottom: 1px solid #00ffcc33;
  padding-bottom: 5px;
  margin-top: 0;
}

/* Main navigation - positioned in the middle */
.sidebar-nav {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin: 20px 0;
}

.sidebar a {
  display: block;
  padding: 12px 15px;
  font-size: 16px;
  text-decoration: none;
  color: #00ffaa;
  border-radius: 6px;
  transition: all 0.2s ease;
  text-align: left;
}

.sidebar a:hover {
  background: #00ffcc22;
  transform: translateX(5px);
}

/* AI section - positioned at bottom */
.ai-section {
  margin-top: auto; /* Pushes this to the bottom */
  padding-top: 20px;
  border-top: 1px solid #00ffcc33;
}

.ai-actions {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-top: 15px;
}

.ai-button {
  background: #00ffcc15;
  border: 1px solid #00ffcc33;
  color: #00ffcc;
  padding: 12px 15px;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s ease;
  text-align: center;
  font-size: 14px;
}

.ai-button:hover {
  background: #00ffcc25;
  transform: translateY(-2px);
}

/* List items */
.sidebar ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.sidebar ul li {
  padding: 12px 15px;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.2s ease, transform 0.2s ease;
  display: flex;
  align-items: center;
  gap: 10px;
}

.sidebar ul li:hover {
  background: #00ffcc22;
  transform: translateX(5px);
}

/* Close button */
.close-btn {
  background: none;
  border: none;
  color: #00ffcc;
  font-size: 24px;
  cursor: pointer;
  padding: 0;
  width: 30px;
  height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 4px;
  position: absolute;
  top: 15px;
  right: 15px;
}

.close-btn:hover {
  background: #00ffcc22;
}

/* Toggle button */
.toggle-btn {
  position: fixed;
  top: 20px;
  left: 20px;
  background: #101018;
  color: #00ffcc;
  border: 1px solid #00ffcc33;
  padding: 10px 15px;
  border-radius: 4px;
  cursor: pointer;
  z-index: 998;
  transition: background 0.3s ease;
}

.toggle-btn:hover {
  background: #00ffcc22;
}

/* Responsive */
@media (max-width: 768px) {
  .sidebar {
    width: 220px;
    padding: 15px;
  }
  
  .toggle-btn {
    top: 15px;
    left: 15px;
    padding: 8px 12px;
  }
  
  .sidebar a {
    padding: 10px 12px;
    font-size: 15px;
  }
  
  .sidebar ul li {
    padding: 10px 12px;
  }
  
  .ai-button {
    padding: 10px 12px;
    font-size: 13px;
  }
}
  .toggle-btn {
    top: 15px;
    left: 15px;
    padding: 8px 10px;
  }

      
      .toggle-btn {
        display: block;
      }
      
      .ai-container {
        width: 100%;
      }
      
      .message {
        max-width: 90%;
      }
      
      .upload-container {
        bottom: 80px;
        right: 15px;
      }
    

    @media (max-width: 480px) {
      .ai-container header {
        padding: 12px 15px;
      }
      
      .ai-container h1 {
        font-size: 1.3rem;
        
      }
      
      .chat-window {
        padding: 15px;
      }
      
      .message {
        max-width: 95%;
        padding: 12px;
      }
      
      .chat-form {
        padding: 12px;
        gap: 8px;
      }
      
      .chat-form textarea {
        padding: 10px 12px;
        font-size: 0.9rem;
      }
      
      .chat-form button[type="submit"] {
        padding: 10px 15px;
        font-size: 0.9rem;
      }
      
      .mic-btn {
        padding: 10px;
      }
      
      .upload-container {
        bottom: 70px;
        right: 10px;
      }
      
      #uploadToggle {
        width: 45px;
        height: 45px;
        font-size: 1.1rem;
      }
    }

    @media (max-width: 360px) {
      .ai-container h1 {
        font-size: 1.2rem;
      }
      
      .chat-window {
        padding: 10px;
      }
      
      .message {
        padding: 10px;
        font-size: 0.9rem;
      }
      
      .chat-form {
        padding: 10px;
      }
    }

    /* ===== CUSTOM SCROLLBAR ===== */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-secondary);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--accent-primary);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #2d68c4;
    }

    /* ===== IMAGE PREVIEW (responsive) ===== */
    .preview-box {
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-end;
      width: 100%;
      max-width: 520px; /* reasonable desktop max */
      margin: 8px 0;
      padding: 8px;
      background: rgba(255,255,255,0.01);
      border-radius: 10px;
      border: 1px solid var(--border-color);
      box-shadow: var(--shadow-light);
    }

    .preview-image {
      width: 100%;
      height: auto;
      max-height: 60vh; /* avoid huge images on tall screens */
      object-fit: contain;
      border-radius: 8px;
      display: block;
    }

    .preview-actions {
      display: flex;
      gap: 8px;
      width: 100%;
      justify-content: flex-end;
    }

    /* Mobile adjustments */
    @media (max-width: 480px) {
      .preview-box {
        max-width: 92vw;
        padding: 6px;
      }
      .preview-image {
        max-height: 40vh;
      }
      .preview-actions {
        justify-content: space-between;
      }
    }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .chat-container {
            width: 100%;
            max-width: 800px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 90vh;
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .chat-header h1 {
            font-size: 24px;
            font-weight: 600;
        }

        .chat-header p {
            opacity: 0.9;
            margin-top: 5px;
            font-size: 14px;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 20px;
            max-width: 80%;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            margin-left: auto;
        }

        .ai-message {
            margin-right: auto;
        }

        .message-content {
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 15px;
            line-height: 1.4;
        }

        .user-message .message-content {
            background: #667eea;
            color: white;
            border-bottom-right-radius: 4px;
        }

        .ai-message .message-content {
            background: white;
            color: #333;
            border: 1px solid #e5e7eb;
            border-bottom-left-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .message-time {
            font-size: 11px;
            color: #888;
            margin-top: 4px;
            padding: 0 8px;
        }

        .user-message .message-time {
            text-align: right;
        }

        .input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 10px;
        }

        .message-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 15px;
            outline: none;
            transition: border-color 0.3s;
        }

        .message-input:focus {
            border-color: #667eea;
        }

        .send-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .send-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .typing-indicator {
            display: none;
            padding: 10px 16px;
            background: white;
            border-radius: 18px;
            border: 1px solid #e5e7eb;
            margin-bottom: 20px;
            width: fit-content;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #667eea;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        @media (max-width: 768px) {
            .chat-container {
                height: 100vh;
                border-radius: 0;
            }
            
            .message {
                max-width: 90%;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h1>Student Companion</h1>
            <p>Ask me anything - I'm here to help!</p>
        </div>

        <div class="chat-messages" id="chatMessages">
            <!-- Messages will appear here -->
            <div class="message ai-message">
                <div class="message-content">
                    Hello! I'm your Black,Your AI assistant. How can I help you today?
                </div>
                <div class="message-time">Just now</div>
            </div>
        </div>

        <div class="typing-indicator" id="typingIndicator">
            <div class="typing-dots">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
        </div>

        <div class="input-container">
            <input 
                type="text" 
                class="message-input" 
                id="messageInput" 
                placeholder="Type your message here..."
                autocomplete="off"
            >
            <button class="send-button" id="sendButton">Send</button>
        </div>
    </div>

    <script>
        // API Configuration
        const OPENROUTER_API_KEY = "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";
        const OPENROUTER_API_URL = "https://openrouter.ai/api/v1/chat/completions";

        // DOM Elements
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const typingIndicator = document.getElementById('typingIndicator');

        // Chat history
        let chatHistory = [
            {
                role: "system",
                content: "You are a helpful AI assistant. Respond in a friendly and informative manner."
            },
            {
                role: "assistant",
                content: "Hello! I'm your AI assistant. How can I help you today?"
            }
        ];

        // Initialize chat
        function initChat() {
            messageInput.focus();
            
            // Send message on Enter key
            messageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // Send message on button click
            sendButton.addEventListener('click', sendMessage);
        }

        // Format time for display
        function formatTime(date = new Date()) {
            return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        // Copy to Clipboard Function
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('âœ… Code copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('âŒ Failed to copy code');
            });
        }

        // Parse AI Response for Code Blocks and Formatting
        function parseAIResponse(text) {
            const parts = [];
            const codeBlockRegex = /```([\s\S]*?)```/g;
            let lastIndex = 0;
            let match;

            while ((match = codeBlockRegex.exec(text)) !== null) {
                // Add text before code block
                if (match.index > lastIndex) {
                    const textBefore = text.substring(lastIndex, match.index);
                    if (textBefore.trim()) {
                        parts.push({ type: 'text', content: textBefore });
                    }
                }

                // Add code block
                const codeContent = match[1].trim();
                const lines = codeContent.split('\n');
                const language = lines[0] && !lines[0].includes(' ') ? lines[0] : 'code';
                const actualCode = lines[0] && !lines[0].includes(' ') ? lines.slice(1).join('\n') : codeContent;
                
                parts.push({ 
                    type: 'code', 
                    language: language,
                    content: actualCode 
                });

                lastIndex = match.index + match[0].length;
            }

            // Add remaining text
            if (lastIndex < text.length) {
                const textAfter = text.substring(lastIndex);
                if (textAfter.trim()) {
                    parts.push({ type: 'text', content: textAfter });
                }
            }

            // If no code blocks found, return entire text as single text part
            if (parts.length === 0) {
                return [{ type: 'text', content: text }];
            }

            return parts;
        }

        // Add message to chat
        function addMessage(role, content) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}-message`;
            
            if (role === 'user') {
                const contentDiv = document.createElement('div');
                contentDiv.className = 'message-content';
                contentDiv.textContent = content;
                
                const timeDiv = document.createElement('div');
                timeDiv.className = 'message-time';
                timeDiv.textContent = formatTime();
                
                messageDiv.appendChild(contentDiv);
                messageDiv.appendChild(timeDiv);
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                return;
            }

            // AI message with code block parsing
            const container = document.createElement('div');
            container.style.display = 'flex';
            container.style.flexDirection = 'column';
            container.style.gap = '8px';

            const parts = parseAIResponse(content);

            parts.forEach((part, idx) => {
                if (part.type === 'text') {
                    const textDiv = document.createElement('div');
                    textDiv.style.whiteSpace = 'pre-wrap';
                    textDiv.style.wordWrap = 'break-word';
                    textDiv.style.lineHeight = '1.6';
                    textDiv.style.marginBottom = '8px';
                    textDiv.textContent = part.content;
                    container.appendChild(textDiv);
                } else if (part.type === 'code') {
                    const codeContainer = document.createElement('div');
                    codeContainer.style.backgroundColor = '#1a1a2e';
                    codeContainer.style.border = '1px solid #667eea33';
                    codeContainer.style.borderRadius = '8px';
                    codeContainer.style.padding = '12px';
                    codeContainer.style.marginBottom = '8px';
                    codeContainer.style.position = 'relative';
                    codeContainer.style.overflow = 'hidden';

                    const langLabel = document.createElement('div');
                    langLabel.textContent = part.language;
                    langLabel.style.fontSize = '11px';
                    langLabel.style.color = '#667eea';
                    langLabel.style.marginBottom = '8px';
                    langLabel.style.fontWeight = 'bold';
                    langLabel.style.textTransform = 'uppercase';
                    codeContainer.appendChild(langLabel);

                    const codeBlock = document.createElement('pre');
                    codeBlock.style.margin = '0';
                    codeBlock.style.color = '#f8f9fa';
                    codeBlock.style.fontFamily = 'Courier New, monospace';
                    codeBlock.style.fontSize = '13px';
                    codeBlock.style.lineHeight = '1.5';
                    codeBlock.style.whiteSpace = 'pre-wrap';
                    codeBlock.style.wordWrap = 'break-word';
                    codeBlock.textContent = part.content;
                    codeContainer.appendChild(codeBlock);

                    const copyBtn = document.createElement('button');
                    copyBtn.textContent = 'ðŸ“‹ Copy';
                    copyBtn.type = 'button';
                    copyBtn.style.position = 'absolute';
                    copyBtn.style.top = '8px';
                    copyBtn.style.right = '8px';
                    copyBtn.style.backgroundColor = '#667eea';
                    copyBtn.style.color = 'white';
                    copyBtn.style.border = 'none';
                    copyBtn.style.padding = '6px 12px';
                    copyBtn.style.borderRadius = '6px';
                    copyBtn.style.cursor = 'pointer';
                    copyBtn.style.fontSize = '12px';
                    copyBtn.style.fontWeight = 'bold';
                    copyBtn.style.transition = 'all 0.2s ease';
                    
                    copyBtn.addEventListener('mouseover', () => {
                        copyBtn.style.backgroundColor = '#764ba2';
                        copyBtn.style.transform = 'scale(1.05)';
                    });
                    
                    copyBtn.addEventListener('mouseout', () => {
                        copyBtn.style.backgroundColor = '#667eea';
                        copyBtn.style.transform = 'scale(1)';
                    });
                    
                    copyBtn.addEventListener('click', () => {
                        copyToClipboard(part.content);
                        copyBtn.textContent = 'âœ… Copied!';
                        setTimeout(() => {
                            copyBtn.textContent = 'ðŸ“‹ Copy';
                        }, 2000);
                    });
                    
                    codeContainer.appendChild(copyBtn);
                    container.appendChild(codeContainer);
                }
            });

            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.appendChild(container);
            
            const timeDiv = document.createElement('div');
            timeDiv.className = 'message-time';
            timeDiv.textContent = formatTime();
            
            messageDiv.appendChild(contentDiv);
            messageDiv.appendChild(timeDiv);
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Show/hide typing indicator
        function showTypingIndicator(show) {
            typingIndicator.style.display = show ? 'block' : 'none';
            if (show) {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }

        // Send message to AI
        async function sendMessage() {
            const message = messageInput.value.trim();
            
            if (!message) return;
            
            // Clear input
            messageInput.value = '';
            
            // Add user message to chat
            addMessage('user', message);
            
            // Add to history
            chatHistory.push({ role: "user", content: message });
            
            // Show typing indicator
            showTypingIndicator(true);
            
            // Disable input while processing
            messageInput.disabled = true;
            sendButton.disabled = true;
            messageInput.classList.add('loading');
            sendButton.classList.add('loading');
            
            try {
                // Call OpenRouter API
                const response = await fetch(OPENROUTER_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${OPENROUTER_API_KEY}`,
                        'HTTP-Referer': window.location.origin,
                        'X-Title': 'AI Chat Assistant'
                    },
                    body: JSON.stringify({
                        model: "openai/gpt-3.5-turbo",
                        messages: chatHistory,
                        max_tokens: 1000,
                        temperature: 0.7
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.choices && data.choices[0]) {
                    const aiResponse = data.choices[0].message.content;
                    
                    // Add AI response to chat
                    addMessage('ai', aiResponse);
                    
                    // Add to history
                    chatHistory.push({ role: "assistant", content: aiResponse });
                } else {
                    throw new Error('No response from AI');
                }
                
            } catch (error) {
                console.error('Error:', error);
                
                // Show error message
                addMessage('ai', `Sorry, I encountered an error: ${error.message}. Please try again.`);
                
            } finally {
                // Re-enable input
                messageInput.disabled = false;
                sendButton.disabled = false;
                messageInput.classList.remove('loading');
                sendButton.classList.remove('loading');
                
                // Hide typing indicator
                showTypingIndicator(false);
                
                // Focus input
                messageInput.focus();
            }
        }

        // Initialize chat when page loads
        document.addEventListener('DOMContentLoaded', initChat);
    </script>
</body>
</html>
